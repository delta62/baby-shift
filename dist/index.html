<!DOCTYPE html>
<html lang="en_US">
  <head>
    <title>Baby shift</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      * {
        margin: 0;
        padding: 0;
      }

      html,
      body {
        display: flex;
        flex-direction: column;
        height: 100%;
        overflow: hidden;
      }

      body {
        align-items: center;
        background: #112;
        color: #ccc;
        font-family: Helvetica, Arial, sans-serif;
        font-size: 2rem;
      }

      .content {
        align-items: center;
        display: flex;
        flex-direction: column;
        flex-grow: 1;
        justify-content: center;
        padding-bottom: 20vh;
      }

      #name {
        margin: 1rem 0 2rem;
      }

      #clock {
        font-weight: bold;
        margin: 2rem 0;
      }

      #until {
        font-size: 1.2rem;
        font-style: italic;
        font-weight: lighter;
      }
    </style>
  </head>
  <body>
    <p id="clock">00:00:00</p>
    <section class="content">
      <h2 id="emoji"></h2>
      <h1 id="name"></h1>
      <p id="until"></p>
    </section>

    <script>
      const HOUR_OF_DAY = 1000 * 60 * 60;
      const EMOJI_START = 0x1f600;
      const EMOJI_END = 0x1f6ff;

      let emoji = document.getElementById("emoji");
      let name = document.getElementById("name");
      let time = document.getElementById("clock");
      let until = document.getElementById("until");

      let updateUI = () => {
        let now = new Date();
        let hour = now.getHours();
        let emojiSeed = Math.floor(now.getTime() / HOUR_OF_DAY);
        let whom;

        switch (hour) {
          case 0:
          case 1:
            whom = "Sam";
            break;
          case 4:
          case 5:
          case 20:
          case 21:
            whom = "Sam";
            break;
          case 2:
          case 3:
          case 6:
          case 7:
          case 22:
          case 23:
            whom = "Codi";
            break;
          default:
            whom = "You";
            break;
        }

        let untilHour = hour % 2 == 0 ? hour + 2 : hour + 1;
        let untilTime = new Date(now.getTime());
        untilTime.setHours(untilHour);
        untilTime.setMinutes(0);
        untilTime.setSeconds(0);

        if (hour >= 22) {
          untilTime.setDate(untilTime.getDate() + 1);
        }

        name.textContent = whom;
        emoji.textContent = randomEmoji(emojiSeed);
        time.textContent = formatTime(now);
        until.textContent = `until ${formatTime(untilTime)}`;
      };

      let formatTime = (date) => {
        let hh = `${date.getHours()}`.padStart(2, "0");
        let mm = `${date.getMinutes()}`.padStart(2, "0");
        let ss = `${date.getSeconds()}`.padStart(2, "0");

        return `${hh}:${mm}:${ss}`;
      };

      let mulberry32 = (a) => {
        return function () {
          var t = (a += 0x6d2b79f5);
          t = Math.imul(t ^ (t >>> 15), t | 1);
          t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
          return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
        };
      };

      let randomEmoji = (seed) => {
        let zeroToOne = mulberry32(seed)();
        let codePoint = Math.floor(
          zeroToOne * (EMOJI_END - EMOJI_START) + EMOJI_START
        );
        return String.fromCodePoint(codePoint);
      };

      updateUI();
      setInterval(updateUI, 1000);
    </script>
  </body>
</html>
